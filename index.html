<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game of the Week Dashboard</title>
    <link rel="icon" type="image/png" href="assets/images/Goblet.png">

    <!-- External Dependencies -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Modular CSS -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/utilities.css">
    <link rel="stylesheet" href="css/components/header.css">
    <link rel="stylesheet" href="css/components/leaderboard.css">
    <link rel="stylesheet" href="css/components/horse-race.css">
    <link rel="stylesheet" href="css/components/matchups.css">
    <link rel="stylesheet" href="css/components/what-if.css">
    <link rel="stylesheet" href="css/components/picks-matrix.css">
    <link rel="stylesheet" href="css/components/modals.css">
</head>
<body>
    <!-- Utility Links (Upper Right) -->
    <div class="league-link">
        <a href="https://curlingmembers.com/Members/LeagueDetail.aspx?id=604" target="_blank" rel="noopener noreferrer">
            MCC Member Page <i class="fas fa-external-link-alt"></i>
        </a>
    </div>

    <div class="dashboard-container">
        <!-- Main Header -->
        <div class="dashboard-header">
            <div class="header-content">
                <img src="assets/images/Goblet.png" alt="Trophy" class="header-goblet">
                <div class="header-text">
                    <h1>Game of the Week</h1>
                    <div class="subtitle">2025-2026 Season</div>
                </div>
            </div>
        </div>

        <div id="loadingMessage" class="loading">Loading dashboard data...</div>
        <div id="errorMessage" class="error" style="display: none;"></div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid" id="dashboardGrid" style="display: none;">

            <!-- Upcoming Matchups Section -->
            <section class="section upcoming-section">
                <h2 class="section-title"><i class="fas fa-fire"></i> Upcoming Matchup(s)</h2>
                <div class="matchups-grid" id="upcomingMatchupsGrid"></div>
                <div class="expand-schedule-container">
                    <button class="expand-schedule-btn" id="expandScheduleBtn">
                        <span id="expandScheduleText">Show Full Schedule</span>
                        <span id="expandScheduleIcon">â–¼</span>
                    </button>
                </div>

                <!-- Full Schedule Section (Initially Hidden) -->
                <div class="schedule-section" id="fullScheduleSection" style="display: none;">
                    <div class="schedule-header">
                        <h2 class="section-title"><i class="fas fa-calendar"></i> Full Game Schedule</h2>
                        <div class="schedule-filters">
                            <button class="schedule-filter-btn active" data-filter="all">All Games</button>
                            <button class="schedule-filter-btn" data-filter="completed">Completed</button>
                            <button class="schedule-filter-btn" data-filter="upcoming">Upcoming</button>
                        </div>
                    </div>

                    <div class="matchups-grid" id="matchupsGrid"></div>
                </div>
            </section>

            <!-- Left Column Container -->
            <div class="left-column-container">
                <!-- Leaderboard Section -->
                <section class="section leaderboard-section">
                    <h2 class="section-title"><i class="fas fa-medal"></i> Current Standings</h2>

                    <div class="stats-summary" id="statsSummary"></div>

                    <!-- Filter Controls -->
                    <div class="filter-section">
                        <button class="filter-toggle-btn" id="filterToggleBtn">
                            <span>Filters</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="filter-controls collapsed" id="filterControls">
                            <div class="filter-group">
                                <label for="teamFilter">Team:</label>
                                <select id="teamFilter">
                                    <option value="">All Teams</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="positionFilter">Position:</label>
                                <select id="positionFilter">
                                    <option value="">All Positions</option>
                                </select>
                            </div>
                            <div class="filter-group checkbox-group">
                                <input type="checkbox" id="funkEngFilter">
                                <label for="funkEngFilter">Funk-Eng Challengers Only (Lead/Second)</label>
                            </div>
                            <button class="filter-btn" id="resetFilters">Reset Filters</button>
                        </div>
                    </div>

                    <table id="leaderboardTable">
                <thead>
                    <tr>
                        <th class="center sortable sorted-asc" data-sort="rank">Rank</th>
                        <th class="sortable" data-sort="name">Player</th>
                        <th class="center sortable" data-sort="wins">Wins</th>
                        <th class="center sortable" data-sort="losses">Losses</th>
                        <th class="center sortable" data-sort="winPct">Win %</th>
                        <th class="center game-history-header" id="gameHistoryHeader">
                            <span id="gameHistoryLabel">Recent Games</span>
                            <span class="expand-header-btn" id="expandHeaderBtn" title="Expand to show all games">+</span>
                        </th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                        </tbody>
                    </table>
                    <div class="tooltip" id="tooltip"></div>
                </section>

                <!-- Combined Picks View Section -->
                <section class="section picks-view-section">
                <div class="picks-view-header">
                    <h2 class="section-title"><i class="fas fa-th"></i> <span id="picksViewTitle">All Player Picks</span></h2>
                    <div class="picks-view-toggle">
                        <button class="picks-toggle-btn active" data-view="matrix">
                            <i class="fas fa-table"></i> Matrix
                        </button>
                        <button class="picks-toggle-btn" data-view="distribution">
                            <i class="fas fa-chart-bar"></i> Distribution
                        </button>
                    </div>
                </div>

                <!-- Matrix View -->
                <div class="picks-view-content" id="matrixView">
                    <div class="matrix-filters">
                        <div class="matrix-filter-group">
                            <label for="matrixWeekFilter">Week:</label>
                            <select id="matrixWeekFilter">
                                <option value="all">All Weeks</option>
                            </select>
                        </div>
                        <div class="matrix-filter-group">
                            <label for="matrixGameFilter">Games:</label>
                            <select id="matrixGameFilter">
                                <option value="all">All Games</option>
                                <option value="completed">Completed Only</option>
                                <option value="upcoming">Upcoming Only</option>
                            </select>
                        </div>
                        <div class="matrix-filter-group">
                            <label for="matrixTeamFilter">Team:</label>
                            <select id="matrixTeamFilter">
                                <option value="all">All Teams</option>
                            </select>
                        </div>
                    </div>

                    <div class="picks-matrix-container">
                        <table class="picks-matrix-table" id="picksMatrixTable">
                            <thead id="matrixTableHead"></thead>
                            <tbody id="matrixTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Distribution View -->
                <div class="picks-view-content" id="distributionView" style="display: none;">
                    <div class="matrix-filters">
                        <div class="matrix-filter-group">
                            <label for="distributionWeekFilter">Week:</label>
                            <select id="distributionWeekFilter">
                                <option value="all">All Weeks</option>
                            </select>
                        </div>
                        <div class="matrix-filter-group">
                            <label for="distributionGameFilter">Games:</label>
                            <select id="distributionGameFilter">
                                <option value="all">All Games</option>
                                <option value="completed">Completed Only</option>
                                <option value="upcoming">Upcoming Only</option>
                            </select>
                        </div>
                        <div class="matrix-filter-group">
                            <label for="distributionTeamFilter">Team:</label>
                            <select id="distributionTeamFilter">
                                <option value="all">All Teams</option>
                            </select>
                        </div>
                    </div>

                    <div class="distribution-list" id="distributionList"></div>
                </div>
            </section>
            </div> <!-- end left-column-container -->

            <!-- Right Column Container -->
            <div class="right-column-container">
                <!-- What-If Analysis Section -->
                <section class="section whatif-section" id="whatifSection" style="display: none;">
                <h2 class="section-title"><i class="fas fa-wand-magic-sparkles"></i> What-If Analysis</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Select winners for upcoming games to see how it would affect the standings. Click a selected team again to unset.</p>

                <!-- Two Column Layout -->
                <div class="whatif-content">
                    <!-- Left Column: Game Selection -->
                    <div class="whatif-column">
                        <div class="whatif-column-title">Select Game Winners</div>

                        <div class="whatif-controls">
                            <button class="whatif-btn secondary" id="resetWhatif">Reset All</button>
                            <button class="whatif-btn secondary" id="pickAllChalk">Pick All Favorites</button>

                            <div class="whatif-player-picker">
                                <label for="playerSelect">Copy picks from:</label>
                                <select id="playerSelect">
                                    <option value="">-- Select Player --</option>
                                </select>
                                <button class="whatif-btn" id="copyPlayerPicks" disabled>Apply</button>
                            </div>
                        </div>

                        <div class="upcoming-games" id="upcomingGames"></div>
                    </div>

                    <!-- Right Column: Projected Standings -->
                    <div class="whatif-column">
                        <div class="whatif-column-title">
                            Hypothetical Standings
                            <span class="whatif-summary-inline">(<strong id="selectionCount">0</strong> of <strong id="totalGamesCount">0</strong> choices)</span>
                        </div>

                        <div class="whatif-results" id="whatifResultsContent">
                            <table class="comparison-table" id="projectedStandingsTable"></table>
                        </div>
                    </div>
                </div>
            </section>

                <!-- Horse Race Section -->
                <section class="section horse-race-section">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> Win Progression</h2>
                    <svg id="horseRaceChart"></svg>
                    <div class="tooltip" id="raceTooltip"></div>
                    <div class="race-controls">
                        <button class="race-btn secondary" id="showAllRace">Show All</button>
                        <button class="race-btn secondary" id="hideAllRace">Hide All</button>
                    </div>
                    <div class="race-legend" id="raceLegend"></div>
                </section>
            </div> <!-- end right-column-container -->

        </div> <!-- end dashboard-grid -->

    </div> <!-- end dashboard-container -->

    <!-- Player Details Modal -->
    <div class="modal-overlay" id="playerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 class="modal-title" id="modalPlayerName"></h2>
                    <div class="modal-subtitle" id="modalPlayerStats"></div>
                </div>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="picks-list" id="modalPicksList"></div>
            </div>
        </div>
    </div>

    <!-- Matchup Tooltip -->
    <div id="matchupTooltip"></div>

    <!-- Main Application Entry Point -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
